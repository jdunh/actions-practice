name: jdunham-infomagnus/file_designer
on:
  workflow_dispatch:
jobs:
  build:
    runs-on:
      - ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v2
    - name: create file
      shell: bash
      run: |-
        echo 'Hello world!
        blah
        blah
        faslkdfj' > created.txt
    - uses: actions/github-script@v3
      env:
        TARGET_LOCATION: "./new"
        FILE_PATTERNS: "**/**.yml,**/**.txt,!**/**.js"
      with:
        script: |-
          const fs = require('fs').promises
          const path = require('path')
          const target = path.resolve(process.env.TARGET_LOCATION)
          const patterns = process.env.FILE_PATTERNS
          const globber = await glob.create(patterns.replace(/,/g, "\n"))
          for await (const file of globber.globGenerator()) {
            if ((await fs.lstat(file)).isDirectory()) continue
            const dest = path.join(target, file.substring(process.cwd().length))
            await io.mkdirP(path.dirname(dest))
            await io.cp(file, dest)
          }
    - name: test before
      shell: bash
      run: |-
        ls -la new
        ls -la new/.github/actions/cat-facts
        cat new/created.txt
    - name: join file
      shell: bash
      run: cat created.txt >> new/created.txt
    - name: move file
      shell: bash
      run: mv new/created.txt new/.github/actions/cat-facts/moved.txt
    - name: copy folder
      shell: bash
      run: |-
        mkdir -p test/more_new
        cp -r new/.github/actions/cat-facts/* test/more_new
    - name: create folder
      shell: bash
      run: mkdir -p foo/goo/zoo
    - name: create file
      shell: bash
      run: |-
        mkdir -p foo/goo/zoo
        echo 'testing is fun...' > foo/goo/zoo/test.txt
    - name: rename/move folder
      shell: bash
      run: mv foo/goo foo/goo2
    - name: run command
      shell: bash
      run: |-
        mkdir -p playground
        touch playground/my_file.txt
        tar zcf playground.tar playground
    - name: untar archive
      shell: bash
      run: |-
        mkdir -p new
        tar zxf playground.tar -C new
    - name: zip folder
      shell: bash
      run: 7z a my_zip/dir1/goo.zip foo/goo2
    - name: unzip folder
      shell: bash
      run: unzip -d output my_zip/dir1/goo.zip
    - name: test after
      shell: bash
      run: |-
        tree
#         ls -la new
#         ls -la my_zip/dir1
